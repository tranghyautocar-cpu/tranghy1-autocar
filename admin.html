<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - TrangHy Autocar</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;700;900&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        body { font-family: 'Montserrat', sans-serif; background: #f8fafc; }
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #f1f5f9; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
        
        .nav-item.active { background-color: #2563eb; color: white; box-shadow: 0 10px 15px -3px rgba(37, 99, 235, 0.3); }
        .status-badge { padding: 4px 12px; border-radius: 99px; font-size: 11px; font-weight: 700; text-transform: uppercase; }
        .status-success { background: #dcfce7; color: #166534; }
        .status-warning { background: #fef9c3; color: #854d0e; }
        .status-danger { background: #fee2e2; color: #991b1b; }
        
        /* Animation cho Modal */
        .modal-enter { animation: fade-in-up 0.3s ease-out forwards; }
        @keyframes fade-in-up {
            from { opacity: 0; transform: scale(0.95); }
            to { opacity: 1; transform: scale(1); }
        }
    </style>
</head>
<body class="flex h-screen overflow-hidden text-slate-800">

    <aside class="w-64 bg-slate-900 text-slate-300 flex flex-col transition-all duration-300 z-20 shadow-2xl">
        <div class="h-24 flex items-center justify-center border-b border-slate-800">
            <div class="flex items-center gap-3">
                <div class="w-10 h-10 bg-white text-slate-900 rounded-xl flex items-center justify-center text-xl font-black italic">T</div>
                <div>
                    <h1 class="text-xl font-black italic text-white tracking-tighter">TRANGHY</h1>
                    <p class="text-[9px] font-bold uppercase tracking-widest text-blue-500">Admin Control</p>
                </div>
            </div>
        </div>
        
        <nav class="flex-1 px-4 py-8 space-y-2">
            <button onclick="switchTab('dashboard')" id="nav-dashboard" class="nav-item w-full flex items-center gap-4 px-4 py-3.5 rounded-xl text-sm font-bold transition-all hover:bg-slate-800 hover:text-white active">
                <i class="fas fa-th-large w-5"></i> T·ªïng quan
            </button>
            <button onclick="switchTab('orders')" id="nav-orders" class="nav-item w-full flex items-center gap-4 px-4 py-3.5 rounded-xl text-sm font-bold transition-all hover:bg-slate-800 hover:text-white">
                <i class="fas fa-file-invoice-dollar w-5"></i> ƒê∆°n h√†ng
                <span class="ml-auto bg-red-500 text-white text-[10px] px-2 py-0.5 rounded-full" id="menu-orders-count">0</span>
            </button>
            <button onclick="switchTab('cars')" id="nav-cars" class="nav-item w-full flex items-center gap-4 px-4 py-3.5 rounded-xl text-sm font-bold transition-all hover:bg-slate-800 hover:text-white">
                <i class="fas fa-car w-5"></i> Qu·∫£n l√Ω Xe
            </button>
            <button onclick="switchTab('drivers')" id="nav-drivers" class="nav-item w-full flex items-center gap-4 px-4 py-3.5 rounded-xl text-sm font-bold transition-all hover:bg-slate-800 hover:text-white">
                <i class="fas fa-users w-5"></i> Qu·∫£n l√Ω T√†i x·∫ø
            </button>
        </nav>

        <div class="p-4 border-t border-slate-800">
            <div class="bg-slate-800/50 rounded-xl p-3 flex items-center gap-3 mb-3">
                <img src="https://ui-avatars.com/api/?name=Admin+Trang&background=0D8ABC&color=fff" class="w-10 h-10 rounded-full">
                <div>
                    <p class="text-xs font-bold text-white">Admin Trang</p>
                    <p class="text-[10px] text-green-400 flex items-center gap-1"><span class="w-1.5 h-1.5 rounded-full bg-green-400"></span> Online</p>
                </div>
            </div>
            <button onclick="logout()" class="w-full flex items-center justify-center gap-2 px-4 py-2 text-red-400 hover:bg-red-500/10 rounded-lg text-xs font-bold transition-all">
                <i class="fas fa-sign-out-alt"></i> ƒêƒÉng xu·∫•t
            </button>
        </div>
    </aside>

    <main class="flex-1 flex flex-col relative overflow-y-auto bg-slate-50/50">
        
        <header class="h-20 bg-white/80 backdrop-blur-md sticky top-0 z-10 px-8 flex items-center justify-between border-b border-slate-100">
            <h2 class="text-2xl font-black text-slate-800" id="page-title">Dashboard</h2>
            <div class="flex items-center gap-4">
                <div class="relative">
                    <input type="text" placeholder="T√¨m ki·∫øm..." class="bg-slate-100 border-none rounded-full px-5 py-2.5 text-sm font-bold text-slate-600 focus:ring-2 focus:ring-blue-500 w-64 transition-all">
                    <i class="fas fa-search absolute right-4 top-3 text-slate-400"></i>
                </div>
                <button class="w-10 h-10 rounded-full bg-white border border-slate-100 flex items-center justify-center text-slate-500 hover:text-blue-600 shadow-sm relative">
                    <i class="fas fa-bell"></i>
                    <span class="absolute top-0 right-0 w-3 h-3 bg-red-500 border-2 border-white rounded-full hidden" id="noti-dot"></span>
                </button>
            </div>
        </header>

        <div class="p-8 space-y-8">

            <div id="view-dashboard" class="content-view animate-fade-in">
                <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                    <div class="bg-white p-6 rounded-3xl shadow-sm border border-slate-100 group hover:shadow-lg transition-all">
                        <div class="flex justify-between items-start mb-4">
                            <div>
                                <p class="text-xs font-bold text-slate-400 uppercase tracking-wider">Doanh thu d·ª± ki·∫øn</p>
                                <h3 class="text-3xl font-black text-slate-800 mt-1" id="stat-revenue">0 <span class="text-sm text-slate-400 font-medium">vnƒë</span></h3>
                            </div>
                            <div class="p-3 bg-blue-50 text-blue-600 rounded-2xl group-hover:bg-blue-600 group-hover:text-white transition-all"><i class="fas fa-wallet text-xl"></i></div>
                        </div>
                        <p class="text-xs font-bold text-green-500"><i class="fas fa-arrow-up"></i> T·ª± ƒë·ªông t√≠nh to√°n</p>
                    </div>

                    <div class="bg-white p-6 rounded-3xl shadow-sm border border-slate-100 group hover:shadow-lg transition-all">
                        <div class="flex justify-between items-start mb-4">
                            <div>
                                <p class="text-xs font-bold text-slate-400 uppercase tracking-wider">ƒê∆°n ƒë·∫∑t xe</p>
                                <h3 class="text-3xl font-black text-slate-800 mt-1" id="stat-orders">0</h3>
                            </div>
                            <div class="p-3 bg-purple-50 text-purple-600 rounded-2xl group-hover:bg-purple-600 group-hover:text-white transition-all"><i class="fas fa-clipboard-list text-xl"></i></div>
                        </div>
                        <p class="text-xs font-bold text-blue-500">ƒê∆°n h√†ng hi·ªán c√≥</p>
                    </div>

                    <div class="bg-white p-6 rounded-3xl shadow-sm border border-slate-100 group hover:shadow-lg transition-all">
                        <div class="flex justify-between items-start mb-4">
                            <div>
                                <p class="text-xs font-bold text-slate-400 uppercase tracking-wider">T·ªïng xe</p>
                                <h3 class="text-3xl font-black text-slate-800 mt-1" id="stat-cars">0</h3>
                            </div>
                            <div class="p-3 bg-orange-50 text-orange-600 rounded-2xl group-hover:bg-orange-600 group-hover:text-white transition-all"><i class="fas fa-car text-xl"></i></div>
                        </div>
                        <p class="text-xs font-bold text-green-500">Xe trong h·ªá th·ªëng</p>
                    </div>

                    <div class="bg-white p-6 rounded-3xl shadow-sm border border-slate-100 group hover:shadow-lg transition-all">
                        <div class="flex justify-between items-start mb-4">
                            <div>
                                <p class="text-xs font-bold text-slate-400 uppercase tracking-wider">T√†i x·∫ø</p>
                                <h3 class="text-3xl font-black text-slate-800 mt-1" id="stat-drivers">0</h3>
                            </div>
                            <div class="p-3 bg-teal-50 text-teal-600 rounded-2xl group-hover:bg-teal-600 group-hover:text-white transition-all"><i class="fas fa-user-tie text-xl"></i></div>
                        </div>
                        <p class="text-xs font-bold text-slate-400">Nh√¢n s·ª± hi·ªán t·∫°i</p>
                    </div>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                    <div class="lg:col-span-2 bg-white p-6 rounded-3xl shadow-sm border border-slate-100">
                        <h3 class="text-lg font-bold text-slate-800 mb-6">Bi·ªÉu ƒë·ªì tƒÉng tr∆∞·ªüng</h3>
                        <canvas id="revenueChart" height="150"></canvas>
                    </div>
                    <div class="bg-white p-6 rounded-3xl shadow-sm border border-slate-100">
                        <h3 class="text-lg font-bold text-slate-800 mb-6">Tr·∫°ng th√°i h·ªá th·ªëng</h3>
                        <div class="space-y-4">
                            <div class="p-4 bg-green-50 rounded-2xl border border-green-100">
                                <p class="text-xs font-bold text-green-600 uppercase mb-1">H·ªá th·ªëng</p>
                                <p class="font-bold text-slate-800">ƒêang ho·∫°t ƒë·ªông b√¨nh th∆∞·ªùng</p>
                            </div>
                            <div class="p-4 bg-blue-50 rounded-2xl border border-blue-100">
                                <p class="text-xs font-bold text-blue-600 uppercase mb-1">C∆° s·ªü d·ªØ li·ªáu</p>
                                <p class="font-bold text-slate-800">LocalStorage (ƒê·ªìng b·ªô)</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="view-orders" class="content-view hidden animate-fade-in">
                <div class="bg-white rounded-3xl shadow-sm border border-slate-100 overflow-hidden">
                    <div class="p-6 border-b border-slate-100 flex justify-between items-center">
                        <h3 class="text-lg font-bold text-slate-800">Danh s√°ch ƒë∆°n ƒë·∫∑t xe</h3>
                        <div class="flex gap-2">
                             <button onclick="alert('T√≠nh nƒÉng ƒëang ph√°t tri·ªÉn')" class="bg-slate-100 text-slate-600 px-4 py-2 rounded-xl text-xs font-bold hover:bg-slate-200"><i class="fas fa-filter mr-2"></i> B·ªô l·ªçc</button>
                        </div>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="w-full text-left border-collapse">
                            <thead>
                                <tr class="bg-slate-50 text-xs uppercase text-slate-400 tracking-wider">
                                    <th class="px-6 py-4 font-bold">M√£ ƒë∆°n</th>
                                    <th class="px-6 py-4 font-bold">Kh√°ch h√†ng</th>
                                    <th class="px-6 py-4 font-bold">Xe / D·ªãch v·ª•</th>
                                    <th class="px-6 py-4 font-bold">Ng√†y ƒëi</th>
                                    <th class="px-6 py-4 font-bold">T·ªïng ti·ªÅn</th>
                                    <th class="px-6 py-4 font-bold">Tr·∫°ng th√°i</th>
                                    <th class="px-6 py-4 font-bold text-right">H√†nh ƒë·ªông</th>
                                </tr>
                            </thead>
                            <tbody id="orders-table-body" class="text-sm font-medium text-slate-600 divide-y divide-slate-100">
                                </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div id="view-cars" class="content-view hidden animate-fade-in">
                 <div class="bg-white rounded-3xl shadow-sm border border-slate-100 overflow-hidden">
                    <div class="p-6 border-b border-slate-100 flex justify-between items-center">
                        <h3 class="text-lg font-bold text-slate-800">ƒê·ªôi xe hi·ªán c√≥</h3>
                        <button onclick="alert('Vui l√≤ng th√™m xe tr·ª±c ti·∫øp trong Code (Demo)')" class="bg-slate-900 text-white px-4 py-2 rounded-xl text-xs font-bold hover:bg-slate-800 transition-all"><i class="fas fa-plus mr-2"></i> Th√™m xe m·ªõi</button>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 p-6" id="cars-grid">
                        </div>
                </div>
            </div>

            <div id="view-drivers" class="content-view hidden animate-fade-in">
                 <div class="bg-white rounded-3xl shadow-sm border border-slate-100 overflow-hidden">
                    <div class="p-6 border-b border-slate-100 flex justify-between items-center">
                        <h3 class="text-lg font-bold text-slate-800">Danh s√°ch t√†i x·∫ø</h3>
                        <button onclick="openAddDriverModal()" class="bg-blue-600 text-white px-4 py-2 rounded-xl text-xs font-bold hover:bg-blue-700 transition-all shadow-lg shadow-blue-600/30">
                            <i class="fas fa-user-plus mr-2"></i> Th√™m t√†i x·∫ø m·ªõi
                        </button>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="w-full text-left">
                            <thead>
                                <tr class="bg-slate-50 text-xs uppercase text-slate-400 tracking-wider">
                                    <th class="px-6 py-4 font-bold">Th√¥ng tin t√†i x·∫ø</th>
                                    <th class="px-6 py-4 font-bold">Li√™n h·ªá & Login</th>
                                    <th class="px-6 py-4 font-bold">Kinh nghi·ªám</th>
                                    <th class="px-6 py-4 font-bold">Tr·∫°ng th√°i</th>
                                    <th class="px-6 py-4 font-bold text-right">H√†nh ƒë·ªông</th>
                                </tr>
                            </thead>
                            <tbody id="drivers-table-body" class="text-sm font-medium text-slate-600 divide-y divide-slate-100">
                                </tbody>
                        </table>
                    </div>
                </div>
            </div>

        </div>
    </main>

    <div id="modal-add-driver" class="hidden fixed inset-0 z-50 flex items-center justify-center">
        <div class="absolute inset-0 bg-slate-900/60 backdrop-blur-sm" onclick="closeAddDriverModal()"></div>
        
        <div class="bg-white w-full max-w-lg rounded-3xl shadow-2xl relative z-10 overflow-hidden modal-enter">
            <div class="bg-slate-50 px-8 py-6 border-b border-slate-100 flex justify-between items-center">
                <h3 class="text-xl font-black text-slate-800">T·∫°o t√†i kho·∫£n T√†i x·∫ø</h3>
                <button onclick="closeAddDriverModal()" class="text-slate-400 hover:text-slate-900"><i class="fas fa-times text-xl"></i></button>
            </div>
            
            <div class="p-8 space-y-4">
                <div class="grid grid-cols-2 gap-4">
                    <div class="space-y-1">
                        <label class="text-[10px] font-bold text-slate-400 uppercase">H·ªç v√† t√™n</label>
                        <input type="text" id="new-driver-name" class="w-full bg-slate-50 border border-slate-200 rounded-xl px-3 py-2.5 font-bold text-sm focus:ring-2 focus:ring-blue-500 outline-none" placeholder="VD: Nguy·ªÖn VƒÉn A">
                    </div>
                    <div class="space-y-1">
                        <label class="text-[10px] font-bold text-slate-400 uppercase">S·ªë ƒëi·ªán tho·∫°i</label>
                        <input type="text" id="new-driver-phone" class="w-full bg-slate-50 border border-slate-200 rounded-xl px-3 py-2.5 font-bold text-sm focus:ring-2 focus:ring-blue-500 outline-none" placeholder="VD: 0912...">
                    </div>
                </div>

                <div class="space-y-1">
                    <label class="text-[10px] font-bold text-slate-400 uppercase">Email (T√™n ƒëƒÉng nh·∫≠p)</label>
                    <input type="email" id="new-driver-email" class="w-full bg-slate-50 border border-slate-200 rounded-xl px-3 py-2.5 font-bold text-sm focus:ring-2 focus:ring-blue-500 outline-none" placeholder="taixe@driver.com">
                </div>

                <div class="grid grid-cols-2 gap-4">
                    <div class="space-y-1">
                        <label class="text-[10px] font-bold text-slate-400 uppercase">M·∫≠t kh·∫©u</label>
                        <input type="text" id="new-driver-pass" class="w-full bg-slate-50 border border-slate-200 rounded-xl px-3 py-2.5 font-bold text-sm focus:ring-2 focus:ring-blue-500 outline-none" placeholder="M·∫∑c ƒë·ªãnh: 123">
                    </div>
                    <div class="space-y-1">
                        <label class="text-[10px] font-bold text-slate-400 uppercase">Kinh nghi·ªám</label>
                        <input type="text" id="new-driver-exp" class="w-full bg-slate-50 border border-slate-200 rounded-xl px-3 py-2.5 font-bold text-sm focus:ring-2 focus:ring-blue-500 outline-none" placeholder="VD: 3 nƒÉm">
                    </div>
                </div>
            </div>

            <div class="px-8 py-6 border-t border-slate-100 bg-slate-50 flex justify-end gap-3">
                <button onclick="closeAddDriverModal()" class="px-6 py-3 rounded-xl font-bold text-sm text-slate-500 hover:bg-slate-200 transition-all">H·ªßy b·ªè</button>
                <button onclick="handleCreateDriver()" class="px-6 py-3 rounded-xl font-bold text-sm bg-slate-900 text-white hover:bg-blue-600 shadow-lg shadow-blue-900/20 transition-all">T·∫°o t√†i kho·∫£n</button>
            </div>
        </div>
    </div>

    <script>
        // --- 1. KH·ªûI T·∫†O D·ªÆ LI·ªÜU G·ªêC (N·∫æU CH∆ØA C√ì) ---
     // --- 1. S·ª¨A L·∫†I H√ÄM KH·ªûI T·∫†O D·ªÆ LI·ªÜU (Force Reset) ---
    function initRealData() {
        // Ki·ªÉm tra XE: N·∫øu ch∆∞a c√≥ KEY ho·∫∑c M·∫£ng R·ªóng -> T·∫°o l·∫°i ngay
        const savedCars = localStorage.getItem('tranghy_cars');
        if (!savedCars || JSON.parse(savedCars).length === 0) {
            const initialCars = [
                { id: 1, name: 'Porsche Panamera', type: 'Sedan h·∫°ng sang', price: '5.000.000', img: 'https://images.unsplash.com/photo-1503376763036-066120622c74', status: 'S·∫µn s√†ng' },
                { id: 2, name: 'Mercedes S450', type: 'Luxury', price: '4.500.000', img: 'https://images.unsplash.com/photo-1618843479313-40f8afb4b4d8', status: 'ƒêang ch·∫°y' },
                { id: 3, name: 'VinFast VF9', type: 'SUV ƒêi·ªán', price: '2.500.000', img: 'https://images.unsplash.com/photo-1617788138017-80ad40651399', status: 'S·∫µn s√†ng' },
                { id: 4, name: 'Toyota Camry', type: 'Sedan', price: '1.200.000', img: 'https://images.unsplash.com/photo-1621007947382-bb3c3968e3bb', status: 'B·∫£o d∆∞·ª°ng' },
                { id: 5, name: 'Kia Carnival', type: 'MPV 7 ch·ªó', price: '1.800.000', img: 'https://images.unsplash.com/photo-1549317661-bd32c8ce0db2', status: 'S·∫µn s√†ng' }
            ];
            localStorage.setItem('tranghy_cars', JSON.stringify(initialCars));
            console.log("ƒê√£ kh√¥i ph·ª•c d·ªØ li·ªáu xe!");
        }

        // Ki·ªÉm tra T√ÄI X·∫æ
        const savedDrivers = localStorage.getItem('drivers_data');
        if (!savedDrivers || JSON.parse(savedDrivers).length === 0) {
            const initialDrivers = [
                { id: 101, name: 'Nguy·ªÖn VƒÉn Long', email: 'long@driver.com', password: '123', phone: '0987654321', exp: '5 nƒÉm', status: 'S·∫µn s√†ng' },
                { id: 102, name: 'Tr·∫ßn VƒÉn T√∫', email: 'tu@driver.com', password: '123', phone: '0912345678', exp: '3 nƒÉm', status: 'ƒêang ch·ªü kh√°ch' }
            ];
            localStorage.setItem('drivers_data', JSON.stringify(initialDrivers));
        }

        // Ki·ªÉm tra ƒê∆†N H√ÄNG
        if (!localStorage.getItem('tranghy_orders')) {
            localStorage.setItem('tranghy_orders', JSON.stringify([]));
        }
    }
        initRealData(); // Ch·∫°y kh·ªüi t·∫°o

        // --- 2. C√ÅC H√ÄM RENDER (HI·ªÇN TH·ªä) ---

        // Render Dashboard Stats
        function updateDashboardStats() {
            const cars = JSON.parse(localStorage.getItem('tranghy_cars')) || [];
            const drivers = JSON.parse(localStorage.getItem('drivers_data')) || [];
            const orders = JSON.parse(localStorage.getItem('tranghy_orders')) || [];

            document.getElementById('stat-cars').innerText = cars.length;
            document.getElementById('stat-drivers').innerText = drivers.length;
            document.getElementById('stat-orders').innerText = orders.length;

            // T√≠nh t·ªïng doanh thu (gi·∫£ l·∫≠p t·ª´ ƒë∆°n h√†ng)
            let totalRevenue = 128500000; // S·ªë g·ªëc
            orders.forEach(o => {
                // Logic ƒë∆°n gi·∫£n: M·ªói ƒë∆°n t√≠nh 2 tri·ªáu cho vui
                if(o.status === 'approved') totalRevenue += 2000000;
            });
            document.getElementById('stat-revenue').innerHTML = (totalRevenue / 1000000).toFixed(1) + 'M <span class="text-sm text-slate-400 font-medium">vnƒë</span>';
        }

        // Render Xe
      function renderCars() {
        // L·∫•y ƒë√∫ng KEY 'tranghy_cars'
        const cars = JSON.parse(localStorage.getItem('tranghy_cars')) || [];
        
        // Tr·ªè ƒë√∫ng ID 'cars-grid' trong HTML
        const container = document.getElementById('cars-grid');
        
        if (!container) return; // N·∫øu kh√¥ng t√¨m th·∫•y div th√¨ d·ª´ng

        if(cars.length === 0) {
            container.innerHTML = '<p class="text-slate-400 col-span-3 text-center">Ch∆∞a c√≥ xe n√†o trong h·ªá th·ªëng.</p>';
            return;
        }

        container.innerHTML = cars.map((car, index) => `
            <div class="bg-slate-50 rounded-2xl p-4 border border-slate-200 relative group">
                <img src="${car.img}" class="w-full h-40 object-cover rounded-xl mb-4">
                <div class="flex justify-between items-start">
                    <div>
                        <h4 class="font-black text-slate-800">${car.name}</h4>
                        <p class="text-xs text-slate-500">${car.type}</p>
                    </div>
                    <span class="status-badge ${car.status === 'S·∫µn s√†ng' ? 'status-success' : 'status-warning'}">${car.status}</span>
                </div>
                <div class="mt-4 flex items-center justify-between">
                    <p class="font-bold text-blue-600">${car.price} <span class="text-[10px] text-slate-400">/ng√†y</span></p>
                    <button onclick="deleteCar(${index})" class="w-8 h-8 rounded-full bg-white border border-slate-200 flex items-center justify-center text-red-500 hover:bg-red-500 hover:text-white transition-all"><i class="fas fa-trash text-xs"></i></button>
                </div>
            </div>
        `).join('');
    }

        // Render T√†i x·∫ø
        function renderDrivers() {
            const drivers = JSON.parse(localStorage.getItem('drivers_data')) || [];
            const tbody = document.getElementById('drivers-table-body');
            
            tbody.innerHTML = drivers.map((d, index) => `
                <tr class="hover:bg-slate-50 transition-colors">
                    <td class="px-6 py-4 flex items-center gap-3">
                        <div class="w-10 h-10 rounded-full bg-slate-200 flex items-center justify-center font-bold text-slate-600">${d.name.charAt(0)}</div>
                        <div>
                            <p class="font-bold text-slate-900">${d.name}</p>
                            <p class="text-xs text-slate-400">ID: TX${d.id}</p>
                        </div>
                    </td>
                    <td class="px-6 py-4">
                        <p class="text-xs font-bold text-slate-800">${d.email}</p>
                        <p class="text-xs text-slate-400">Pass: ${d.password}</p>
                        <p class="text-xs text-blue-500 mt-1">${d.phone}</p>
                    </td>
                    <td class="px-6 py-4">${d.exp}</td>
                    <td class="px-6 py-4">
                        <span class="status-badge ${d.status === 'S·∫µn s√†ng' ? 'status-success' : 'status-warning'}">${d.status}</span>
                    </td>
                    <td class="px-6 py-4 text-right">
                         <button onclick="deleteDriver(${index})" class="text-red-500 hover:underline font-bold text-xs">X√≥a</button>
                    </td>
                </tr>
            `).join('');
        }

        // Render ƒê∆°n h√†ng
        function renderOrders() {
            const orders = JSON.parse(localStorage.getItem('tranghy_orders')) || [];
            const tbody = document.getElementById('orders-table-body');
            
            // C·∫≠p nh·∫≠t s·ªë ƒë·∫øm ·ªü menu
            const pendingCount = orders.filter(o => o.status === 'pending').length;
            document.getElementById('menu-orders-count').innerText = pendingCount;
            
            // Hi·ªán ch·∫•m ƒë·ªè th√¥ng b√°o n·∫øu c√≥ ƒë∆°n m·ªõi
            const notiDot = document.getElementById('noti-dot');
            if(pendingCount > 0) notiDot.classList.remove('hidden');
            else notiDot.classList.add('hidden');

            if(orders.length === 0) {
                tbody.innerHTML = '<tr><td colspan="7" class="text-center py-8 text-slate-400">Ch∆∞a c√≥ ƒë∆°n h√†ng n√†o.</td></tr>';
                return;
            }

            tbody.innerHTML = orders.map((order, index) => `
                <tr class="hover:bg-slate-50 transition-colors">
                    <td class="px-6 py-4 font-bold text-slate-900">#${order.id}</td>
                    <td class="px-6 py-4 font-bold">
                        ${order.customerName}<br>
                        <span class="text-[10px] text-slate-400 font-normal">${order.customerPhone}</span>
                    </td>
                    <td class="px-6 py-4">${order.carName}</td>
                    <td class="px-6 py-4">${order.date}</td>
                    <td class="px-6 py-4 font-black text-slate-900">${order.totalPrice || 'Li√™n h·ªá'}</td>
                    <td class="px-6 py-4">
                        <span class="status-badge ${order.status === 'pending' ? 'status-warning' : (order.status === 'approved' ? 'status-success' : 'status-danger')}">
                            ${order.status === 'pending' ? 'Ch·ªù duy·ªát' : (order.status === 'approved' ? 'ƒê√£ duy·ªát' : 'ƒê√£ h·ªßy')}
                        </span>
                    </td>
                    <td class="px-6 py-4 text-right flex gap-2 justify-end">
                        ${order.status === 'pending' ? `
                            <button onclick="updateOrderStatus(${index}, 'approved')" class="bg-green-100 text-green-700 px-3 py-1 rounded text-xs font-bold hover:bg-green-200">Duy·ªát</button>
                            <button onclick="updateOrderStatus(${index}, 'cancelled')" class="bg-red-100 text-red-700 px-3 py-1 rounded text-xs font-bold hover:bg-red-200">H·ªßy</button>
                        ` : '<span class="text-xs text-slate-400 font-bold">ƒê√£ x·ª≠ l√Ω</span>'}
                    </td>
                </tr>
            `).join('');
        }

        // --- 3. C√ÅC H√ÄM X·ª¨ L√ù (LOGIC) ---

        // X√≥a Xe
        function deleteCar(index) {
            if(confirm('X√≥a xe n√†y?')) {
                const cars = JSON.parse(localStorage.getItem('tranghy_cars'));
                cars.splice(index, 1);
                localStorage.setItem('tranghy_cars', JSON.stringify(cars));
                renderCars();
                updateDashboardStats();
            }
        }

        // X√≥a T√†i x·∫ø
        function deleteDriver(index) {
            if(confirm('X√≥a t√†i x·∫ø n√†y? H·ªç s·∫Ω kh√¥ng th·ªÉ ƒëƒÉng nh·∫≠p ƒë∆∞·ª£c n·ªØa!')) {
                const drivers = JSON.parse(localStorage.getItem('drivers_data'));
                drivers.splice(index, 1);
                localStorage.setItem('drivers_data', JSON.stringify(drivers));
                renderDrivers();
                updateDashboardStats();
            }
        }

        // Duy·ªát/H·ªßy ƒê∆°n
        function updateOrderStatus(index, newStatus) {
            const orders = JSON.parse(localStorage.getItem('tranghy_orders'));
            orders[index].status = newStatus;
            localStorage.setItem('tranghy_orders', JSON.stringify(orders));
            renderOrders();
            updateDashboardStats();
            alert(`ƒê√£ c·∫≠p nh·∫≠t ƒë∆°n h√†ng th√†nh: ${newStatus === 'approved' ? 'DUY·ªÜT' : 'H·ª¶Y'}`);
        }

        // --- 4. T·∫†O T√ÄI KHO·∫¢N T√ÄI X·∫æ M·ªöI ---
        const addDriverModal = document.getElementById('modal-add-driver');

        function openAddDriverModal() {
            addDriverModal.classList.remove('hidden');
        }

        function closeAddDriverModal() {
            addDriverModal.classList.add('hidden');
            // Reset form
            document.getElementById('new-driver-name').value = '';
            document.getElementById('new-driver-email').value = '';
            document.getElementById('new-driver-pass').value = '';
            document.getElementById('new-driver-phone').value = '';
            document.getElementById('new-driver-exp').value = '';
        }

        function handleCreateDriver() {
            const name = document.getElementById('new-driver-name').value;
            const email = document.getElementById('new-driver-email').value;
            const pass = document.getElementById('new-driver-pass').value;
            const phone = document.getElementById('new-driver-phone').value;
            const exp = document.getElementById('new-driver-exp').value;

            if(!name || !email || !pass) {
                alert("Vui l√≤ng nh·∫≠p T√™n, Email v√† M·∫≠t kh·∫©u!");
                return;
            }

            const drivers = JSON.parse(localStorage.getItem('drivers_data')) || [];
            
            // Check tr√πng email
            if(drivers.some(d => d.email === email)) {
                alert("Email n√†y ƒë√£ t·ªìn t·∫°i!");
                return;
            }

            const newDriver = {
                id: Math.floor(Math.random() * 10000),
                name: name,
                email: email,
                password: pass,
                phone: phone || 'Ch∆∞a c·∫≠p nh·∫≠t',
                exp: exp || 'M·ªõi',
                status: 'S·∫µn s√†ng'
            };

            drivers.push(newDriver);
            localStorage.setItem('drivers_data', JSON.stringify(drivers));
            
            alert("‚úÖ ƒê√£ t·∫°o t√†i kho·∫£n t√†i x·∫ø th√†nh c√¥ng!");
            closeAddDriverModal();
            renderDrivers();
            updateDashboardStats();
        }

        // --- 5. H·ªÜ TH·ªêNG (TAB & LOGOUT) ---
        function switchTab(tabName) {
            const titles = { 'dashboard': 'T·ªïng quan', 'orders': 'Qu·∫£n l√Ω ƒê∆°n h√†ng', 'cars': 'Qu·∫£n l√Ω ƒê·ªôi xe', 'drivers': 'Qu·∫£n l√Ω T√†i x·∫ø' };
            document.getElementById('page-title').innerText = titles[tabName];

            document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
            document.getElementById(`nav-${tabName}`).classList.add('active');

            document.querySelectorAll('.content-view').forEach(el => el.classList.add('hidden'));
            document.getElementById(`view-${tabName}`).classList.remove('hidden');

            if(tabName === 'cars') renderCars();
            if(tabName === 'orders') renderOrders();
            if(tabName === 'drivers') renderDrivers();
            if(tabName === 'dashboard') updateDashboardStats();
        }

        function logout() {
            if(confirm("ƒêƒÉng xu·∫•t kh·ªèi Admin?")) {
                localStorage.removeItem('tranghy_user');
                window.location.href = 'login.html';
            }
        }

        function checkAuth() {
            const user = JSON.parse(localStorage.getItem('tranghy_user'));
            if (!user || user.role !== 'ADMIN') {
                alert("‚õî Vui l√≤ng ƒëƒÉng nh·∫≠p quy·ªÅn Admin!");
                window.location.href = 'login.html';
            }
        }

        // --- KH·ªûI CH·∫†Y ---
        checkAuth();
        updateDashboardStats();
        renderOrders(); // Load tr∆∞·ªõc ƒë·ªÉ l·∫•y s·ªë badge

        // V·∫Ω bi·ªÉu ƒë·ªì
        document.addEventListener('DOMContentLoaded', function() {
            const ctx = document.getElementById('revenueChart').getContext('2d');
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['T1', 'T2', 'T3', 'T4', 'T5', 'T6', 'T7'],
                    datasets: [{
                        label: 'Doanh thu (Tri·ªáu VNƒê)',
                        data: [65, 59, 80, 81, 106, 115, 128],
                        borderColor: '#2563eb',
                        backgroundColor: 'rgba(37, 99, 235, 0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: { responsive: true, plugins: { legend: { display: false } }, scales: { y: { beginAtZero: true } } }
            });
        });
        window.addEventListener('storage', function(e) {
        // N·∫øu kho ƒë∆°n h√†ng b·ªã thay ƒë·ªïi (c√≥ kh√°ch ƒë·∫∑t xe)
        if (e.key === 'tranghy_orders') {
            console.log("üîî C√≥ ƒë∆°n h√†ng m·ªõi! ƒêang c·∫≠p nh·∫≠t...");
            
            // V·∫Ω l·∫°i b·∫£ng ƒë∆°n h√†ng
            renderOrders();
            
            // C·∫≠p nh·∫≠t s·ªë li·ªáu th·ªëng k√™
            updateDashboardStats();
            
            // (T√πy ch·ªçn) Ph√°t √¢m thanh ho·∫∑c hi·ªán th√¥ng b√°o
            alert("üîî TINH TING! C√≥ ƒë∆°n ƒë·∫∑t xe m·ªõi!");
        }
    });
    </script>
    <script src="js/admin.js"></script>
</body>
</html>