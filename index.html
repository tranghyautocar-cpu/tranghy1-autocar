<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TrangHy Autocar - Hệ Thống Cho Thuê Xe & Tài Xế Chuyên Nghiệp</title>

    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
    <script type="text/javascript">
        (function() {
            emailjs.init("s8mToEhBNaMyjjVQc"); 
        })();
    </script>

    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    
    <style>
        :root { 
            --primary: #2563eb; 
            --primary-dark: #1a4bd3;
            --dark: #0f172a; 
            --bg: #fdfdfe; 
            --accent: #3b82f6;
        }
        
        body { 
            font-family: 'Plus Jakarta Sans', sans-serif; 
            background-color: var(--bg); 
            color: var(--dark);
            scroll-behavior: smooth;
            padding-top: 80px; /* Tránh nội dung bị đè bởi Header cố định */
        }

        nav {
        position: fixed !important;
        top: 0;
        left: 0;
        width: 100%;
        z-index: 1000; /* Nên để thấp hơn Modal (Modal thường là 9999) */
        background: rgba(255, 255, 255, 0.8) !important;
        backdrop-filter: blur(12px);
        -webkit-backdrop-filter: blur(12px);
        border-bottom: 1px solid rgba(0,0,0,0.05);
        transition: all 0.3s ease;
    }

        /* FIX MODAL: Ẩn triệt để khi không sử dụng */
        #modal-car, #modal-driver, #payment-modal {
            display: none; /* Ẩn mặc định */
            position: fixed;
            inset: 0;
            z-index: 9999;
            align-items: center;
            justify-content: center;
            background: rgba(15, 23, 42, 0.7);
            backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
        }

        /* Class để JS gọi hiện modal */
        .modal-active {
            display: flex !important;
        }

        /* Card thiết kế Luxury */
        .car-card, .driver-card { 
            background: white;
            border-radius: 2.5rem;
            transition: all 0.5s cubic-bezier(0.16, 1, 0.3, 1);
            border: 1px solid rgba(226, 232, 240, 0.6);
            overflow: hidden;
            cursor: pointer;
        }

        .car-card:hover { 
            transform: translateY(-12px);
            box-shadow: 0 30px 60px -15px rgba(15, 23, 42, 0.08);
            border-color: var(--accent);
        }

        /* Nút bấm hiệu ứng Premium */
        .btn-gradient-blue {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 4px 15px rgba(37, 99, 235, 0.2);
            cursor: pointer;
        }

        .btn-gradient-blue:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 25px -5px rgba(37, 99, 235, 0.4);
        }

        /* Trạng thái bận */
        .is-busy {
            filter: grayscale(0.9) opacity(0.5) !important;
            pointer-events: none !important;
            position: relative;
        }
       
        .is-busy::after {
            content: 'ĐÃ ĐƯỢC ĐẶT LỊCH';
            position: absolute;
            top: 25px; right: 25px;
            background: #ef4444;
            color: #fff;
            padding: 6px 14px;
            font-weight: 800;
            font-size: 9px;
            border-radius: 99px;
            letter-spacing: 1px;
            z-index: 20;
        }

        /* Tiêu đề Gradient */
        .text-luxury {
            background: linear-gradient(to right, #0f172a, #2563eb);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        /* Custom Scroll cho điều khoản trong Modal */
        .terms-scroll::-webkit-scrollbar { width: 4px; }
        .terms-scroll::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
        /* Định vị bộ nút */
/* Container cố định bên phải */
/* Container tổng */
.vip-contact-container {
    position: fixed !important;
    bottom: 30px !important;
    right: 30px !important;
    z-index: 999999 !important;
    display: flex !important;
    flex-direction: column !important;
    gap: 20px !important;
    align-items: flex-end !important;
}

/* Nút bấm chính - Phải là khối vuông để Pulse chuẩn */
.vip-btn {
    width: 60px !important;
    height: 60px !important;
    display: flex !important;
    align-items: center !important;
    justify-content: center !important;
    position: relative !important;
    text-decoration: none !important;
}

/* Hộp icon tròn - Luôn ở trung tâm */
.icon-box {
    width: 60px !important;
    height: 60px !important;
    border-radius: 50% !important;
    display: flex !important;
    justify-content: center !important;
    align-items: center !important;
    position: relative !important;
    z-index: 5 !important; /* Nằm trên cùng */
    box-shadow: 0 8px 20px rgba(0,0,0,0.3) !important;
    transition: all 0.3s ease !important;
}

.fb-vip .icon-box { background: #1877F2 !important; color: white !important; font-size: 26px !important; }
.zalo-vip .icon-box { background: #0068ff !important; color: white !important; font-size: 26px !important; }

/* Vòng tròn nhấp nháy - Căn giữa tuyệt đối 100% */
.vip-pulse {
    position: absolute !important;
    top: 50% !important;
    left: 50% !important;
    width: 60px !important;
    height: 60px !important;
    margin-top: -30px !important; /* Một nửa chiều cao */
    margin-left: -30px !important; /* Một nửa chiều rộng */
    border-radius: 50% !important;
    z-index: 1 !important;
    pointer-events: none !important;
    animation: vip-pulse-ring-new 2s cubic-bezier(0.455, 0.03, 0.515, 0.955) infinite !important;
}

.fb-vip .vip-pulse { background: rgba(24, 119, 242, 0.7) !important; }
.zalo-vip .vip-pulse { background: rgba(0, 104, 255, 0.7) !important; }

/* Hiệu ứng nhấp nháy mượt mà hơn */
@keyframes vip-pulse-ring-new {
    0% { transform: scale(1); opacity: 0.8; }
    100% { transform: scale(2.2); opacity: 0; }
}

/* Nhãn chữ (Label) */
.btn-label {
    position: absolute !important;
    right: 75px !important;
    background: rgba(0, 0, 0, 0.8) !important;
    color: white !important;
    padding: 8px 15px !important;
    border-radius: 20px !important;
    font-size: 13px !important;
    font-weight: bold !important;
    opacity: 0 !important;
    visibility: hidden !important;
    white-space: nowrap !important;
    transition: all 0.3s ease !important;
    box-shadow: 0 4px 10px rgba(0,0,0,0.2) !important;
}
.vip-btn:hover .btn-label {
    opacity: 1 !important;
    visibility: visible !important;
    right: 80px !important;
}

.vip-btn:hover .icon-box {
    transform: scale(1.1) rotate(360deg) !important;
}
    </style>
 <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
<script src="https://npmcdn.com/flatpickr/dist/l10n/vn.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body class="antialiased">
  <nav class="fixed w-full z-40 top-0 transition-all duration-300 p-4">
    <div class="max-w-7xl mx-auto bg-white/90 backdrop-blur-xl border border-white/40 rounded-full shadow-2xl p-2 pl-6 flex justify-between items-center ring-1 ring-slate-900/5">
        
        <a href="#" class="flex items-center gap-3 group" onclick="location.reload()">
            <div class="w-10 h-10 bg-slate-900 text-white rounded-full flex items-center justify-center font-black text-xl italic group-hover:rotate-12 transition-transform shadow-lg shadow-slate-900/30">T</div>
            <div class="flex flex-col">
                <span class="font-black text-lg leading-none italic text-slate-900">TRANGHY</span>
                <span class="text-[8px] font-bold text-blue-600 tracking-[0.3em] uppercase">Autocar</span>
            </div>
        </a>

        <div class="hidden md:flex items-center bg-slate-100/80 rounded-full p-1 border border-slate-200/50">
            <a href="#" class="px-6 py-2 rounded-full bg-white text-slate-900 font-bold text-xs uppercase shadow-sm">Trang chủ</a>
            <a href="#car-list" class="px-6 py-2 rounded-full text-slate-500 hover:text-blue-600 font-bold text-xs uppercase transition-colors">Xe</a>
            <a href="#display-drivers" class="px-6 py-2 rounded-full text-slate-500 hover:text-blue-600 font-bold text-xs uppercase transition-colors">Tài xế</a>
        </div>

<div class="flex items-center gap-2 pr-2">
    
    <button id="btn-login-nav" onclick="window.location.href='login.html'" class="flex items-center gap-2 bg-slate-900 text-white px-5 py-2.5 rounded-full font-bold text-xs uppercase hover:bg-blue-600 transition-all shadow-lg hover:shadow-blue-500/30">
        <i class="fas fa-user-circle text-lg"></i> 
        <span>Đăng nhập</span>
    </button>

    <div id="user-menu-nav" class="hidden flex items-center gap-3">
        <div class="text-right hidden sm:block">
            <p id="user-name-display" class="text-xs font-black text-slate-900">User</p>
            <p id="user-role-display" class="text-[9px] font-bold text-blue-600 uppercase">Vai trò</p>
        </div>
        
        <button onclick="app.showDashboard()" class="w-10 h-10 bg-blue-100 text-blue-600 rounded-full flex items-center justify-center hover:bg-blue-600 hover:text-white transition-all shadow-md relative group">
            <i class="fas fa-th-large"></i>
            <span class="absolute top-12 right-0 bg-slate-800 text-white text-[10px] py-1 px-2 rounded opacity-0 group-hover:opacity-100 transition-opacity whitespace-nowrap pointer-events-none z-50">Vào Dashboard</span>
        </button>
        
        <button onclick="app.logout()" class="w-10 h-10 bg-red-50 text-red-500 rounded-full flex items-center justify-center hover:bg-red-500 hover:text-white transition-all shadow-md" title="Đăng xuất">
            <i class="fas fa-power-off"></i>
        </button>
    </div>

</div>
</nav>
<div id="toast-container" class="fixed top-24 right-5 z-[110] space-y-3 pointer-events-none"></div>

    <header class="relative min-h-[90vh] flex items-center overflow-hidden bg-white">
        <div class="absolute inset-0 z-0">
            <div class="absolute top-[-10%] right-[-5%] w-[600px] h-[600px] bg-blue-100/50 rounded-full blur-[120px]"></div>
            <div class="absolute bottom-[-10%] left-[-5%] w-[400px] h-[400px] bg-slate-100 rounded-full blur-[100px]"></div>
        </div>

        <div class="max-w-7xl mx-auto px-6 w-full relative z-10 py-20">
            <div class="flex flex-col lg:flex-row items-center gap-16 lg:gap-24">
                <div class="lg:w-1/2 space-y-8 fade-in">
                    <div class="inline-flex items-center gap-2 bg-slate-900 text-white px-5 py-2 rounded-full shadow-lg shadow-blue-200/50">
                        <span class="flex h-2 w-2 relative">
                            <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-blue-400 opacity-75"></span>
                            <span class="relative inline-flex rounded-full h-2 w-2 bg-blue-400"></span>
                        </span>
                        <span class="text-[10px] font-bold uppercase tracking-[0.2em]">Hệ thống vận tải số 1 Hưng Yên</span>
                    </div>

                    <div class="space-y-4">
                        <h2 class="text-6xl lg:text-8xl font-black leading-[0.85] text-slate-900 tracking-tighter">
                            Lái phong cách<br>
                            <span class="text-blue-600 italic shiny-text">Sống đam mê.</span>
                        </h2>
                        <p class="text-slate-500 text-lg md:text-xl font-medium leading-relaxed max-w-lg border-l-4 border-blue-600 pl-6 italic">
                            TrangHy Autocar định nghĩa lại tiêu chuẩn di chuyển. Sở hữu hành trình riêng với dàn xe đời mới và đội ngũ tài xế chuyên nghiệp.
                        </p>
                    </div>

                    <div class="flex flex-col sm:row-row gap-5 pt-4">
                        <div class="flex flex-wrap gap-4">
                            <a href="#inventory" class="btn-gradient px-10 py-5 rounded-2xl font-black text-xs uppercase tracking-widest shadow-2xl flex items-center gap-3">
                                Khám phá đội xe <i class="fas fa-arrow-right text-[10px]"></i>
                            </a>
                        </div>
                        <div class="flex items-center gap-6 p-4 bg-slate-50/50 rounded-3xl w-fit backdrop-blur-sm border border-white">
                            <div class="flex -space-x-3">
                                <img src="https://i.pravatar.cc/100?u=a1" class="w-10 h-10 rounded-full border-2 border-white object-cover">
                                <img src="https://i.pravatar.cc/100?u=a2" class="w-10 h-10 rounded-full border-2 border-white object-cover">
                                <div class="w-10 h-10 rounded-full border-2 border-white bg-blue-600 flex items-center justify-center text-[10px] text-white font-bold">+2k</div>
                            </div>
                            <div>
                                <div class="flex text-yellow-400 text-[8px] mb-1">
                                    <i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i>
                                </div>
                                <p class="text-[10px] font-black text-slate-900 uppercase">Khách hàng hài lòng</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="lg:w-1/2 relative hero-visual-container fade-in" style="animation-delay: 0.3s;">
                    <div class="absolute -top-10 -right-10 z-20 bg-white p-6 rounded-[2.5rem] shadow-2xl floating-element hidden md:block border border-slate-50">
                        <div class="flex items-center gap-4">
                            <div class="w-12 h-12 bg-green-500/10 rounded-2xl flex items-center justify-center text-green-600">
                                <i class="fas fa-check-circle text-xl"></i>
                            </div>
                            <div>
                                <p class="text-[10px] font-black text-slate-400 uppercase">Trạng thái</p>
                                <p class="text-sm font-black text-slate-900">Sẵn sàng giao xe</p>
                            </div>
                        </div>
                    </div>
                    <div class="relative z-10">
                        <div class="absolute inset-0 bg-blue-600 rounded-[4rem] rotate-6 scale-95 opacity-10"></div>
                        <div class="relative overflow-hidden rounded-[4rem] shadow-2xl border-[12px] border-white">
                            <img src="https://images.unsplash.com/photo-1503376780353-7e6692767b70?q=80&w=1200" class="w-full h-[550px] object-cover">
                        </div>
                    </div>
                    <div class="absolute -bottom-6 -left-6 z-20 bg-slate-900 p-8 rounded-[3rem] shadow-2xl border-4 border-white animate-bounce">
                        <p class="text-[9px] font-black text-blue-400 uppercase mb-1 tracking-widest">Giá chỉ từ</p>
                        <p class="text-3xl font-black text-white italic">500k<span class="text-xs text-slate-400">/ngày</span></p>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <main id="inventory" class="max-w-7xl mx-auto px-6 py-24">
    </main>
   <div id="filter-container" class="flex p-2 bg-slate-100 rounded-[2rem] gap-2 overflow-x-auto no-scrollbar w-full lg:w-auto">
    <button onclick="app.filterCars('all', event)" 
        class="filter-btn whitespace-nowrap px-10 py-4 rounded-[1.5rem] text-[11px] font-black uppercase tracking-widest transition-all duration-300 bg-white shadow-lg text-blue-600">
        TẤT CẢ XE
    </button>
    
    <button onclick="app.filterCars('4 chỗ', event)" 
        class="filter-btn whitespace-nowrap px-10 py-4 rounded-[1.5rem] text-[11px] font-black uppercase tracking-widest transition-all duration-300 text-slate-500 hover:bg-white/50">
        4 CHỖ
    </button>
    
    <button onclick="app.filterCars('5 chỗ', event)" 
        class="filter-btn whitespace-nowrap px-10 py-4 rounded-[1.5rem] text-[11px] font-black uppercase tracking-widest transition-all duration-300 text-slate-500 hover:bg-white/50">
        5 CHỖ
    </button>
    
    <button onclick="app.filterCars('7 chỗ', event)" 
        class="filter-btn whitespace-nowrap px-10 py-4 rounded-[1.5rem] text-[11px] font-black uppercase tracking-widest transition-all duration-300 text-slate-500 hover:bg-white/50">
        7 CHỖ
    </button>
</div>
            <div class="relative w-full lg:w-[400px] group">
                <i class="fas fa-search absolute left-7 top-1/2 -translate-y-1/2 text-slate-400 group-focus-within:text-blue-600 transition-colors"></i>
                <input type="text" id="carSearch" onkeyup="app.searchCar()" placeholder="Tìm kiếm mẫu xe yêu thích..." class="w-full pl-16 pr-8 py-5 rounded-[2rem] bg-slate-50 border-none ring-1 ring-slate-200 focus:ring-2 focus:ring-blue-600 outline-none font-bold text-sm shadow-inner transition-all">
            </div>
        </div>
        <div id="car-list" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-10 min-h-[400px]"></div>
    </main>

    <section id="drivers-section" class="py-32 bg-slate-50 border-y border-slate-100">
        <div class="max-w-7xl mx-auto px-6">
            <div class="flex flex-col md:flex-row justify-between items-end mb-24 gap-10">
                <div class="space-y-6">
                    <div class="flex items-center gap-4">
                        <span class="w-12 h-[2px] bg-blue-600"></span>
                        <span class="text-blue-600 font-black text-[11px] uppercase tracking-[0.5em]">Tài xế chuyên nghiệp</span>
                    </div>
                    <h2 class="text-6xl font-black text-slate-900 tracking-tighter italic leading-none">P.S.P <span class="text-blue-600">Elite Team</span></h2>
                    <p class="text-slate-400 max-w-lg font-medium text-lg leading-relaxed italic">Mỗi tài xế là một đại sứ dịch vụ - Lái xe bằng cả trái tim.</p>
                </div>
                <div class="flex bg-white p-3 rounded-[2.5rem] shadow-xl border border-slate-100">
                    <div class="px-10 py-6 text-center">
                      <p id="total-drivers-count" class="text-4xl font-black text-slate-900 leading-none"></p>
                        <p class="text-[10px] font-black text-slate-400 uppercase mt-3 tracking-widest">Đang sẵn sàng</p>
                    </div>
                    <div class="w-[1px] bg-slate-100 h-12 self-center"></div>
                    <div class="px-10 py-6 text-center">
                        <p class="text-4xl font-black text-blue-600 leading-none">10Y</p>
                        <p class="text-[10px] font-black text-slate-400 uppercase mt-3 tracking-widest">KN Trung bình</p>
                    </div>
                </div>
            </div>
            <div id="display-drivers" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8"></div>
        </div>
    </section>

 <div id="modal-car" class="hidden fixed inset-0 z-[110] flex items-center justify-center p-4">
    <div class="absolute inset-0 bg-slate-900/60 backdrop-blur-md" onclick="app.closeCar()"></div>
    
    <div class="bg-white w-full max-w-6xl rounded-[3rem] overflow-hidden relative shadow-2xl flex flex-col md:flex-row modal-anim max-h-[95vh] z-10">
        <div class="md:w-5/12 bg-slate-100 relative h-64 md:h-auto">
            <img id="d-img" src="" class="w-full h-full object-cover">
            <span id="d-cat" class="absolute top-8 left-8 bg-blue-600 text-white px-5 py-2 rounded-full text-[10px] font-black uppercase italic shadow-xl">Hạng xe</span>
        </div>

        <div class="md:w-7/12 p-8 md:p-12 space-y-6 overflow-y-auto custom-scroll bg-white">
            <div class="flex justify-between items-start">
                <div class="space-y-1">
                    <span class="text-[10px] font-black text-blue-600 uppercase tracking-[0.3em]">Hệ thống TrangHy</span>
                    <h3 id="d-name" class="text-3xl md:text-4xl font-black text-slate-900 tracking-tight leading-none">Tên xe</h3>
                </div>
                <button onclick="app.closeCar()" class="w-12 h-12 flex items-center justify-center bg-slate-50 rounded-2xl text-slate-400 hover:bg-red-50 hover:text-red-500 transition-all shadow-sm">
                    <i class="fas fa-times text-lg"></i>
                </button>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                <div class="space-y-5">
                    <h4 class="text-[11px] font-black text-slate-900 uppercase border-l-4 border-blue-600 pl-3 italic">1. Lịch trình & Dịch vụ</h4>
                    
                    <div class="grid grid-cols-2 gap-3">
                        <div class="space-y-1">
                            <label class="text-[9px] font-black text-slate-400 uppercase ml-2">Nhận xe</label>
                            <input type="date" id="modal-start-date" onchange="app.updateTotal()" class="w-full bg-slate-50 p-3 rounded-xl border border-slate-100 font-bold text-xs outline-none focus:ring-2 focus:ring-blue-600 transition-all">
                        </div>
                        <div class="space-y-1">
                            <label class="text-[9px] font-black text-slate-400 uppercase ml-2">Trả xe</label>
                            <input type="date" id="modal-end-date" onchange="app.updateTotal()" class="w-full bg-slate-50 p-3 rounded-xl border border-slate-100 font-bold text-xs outline-none focus:ring-2 focus:ring-blue-600 transition-all">
                        </div>
                    </div>
                    
                    <div class="space-y-3">
                        <label class="text-[9px] font-black text-slate-400 uppercase ml-2">Hình thức nhận xe</label>
                        <div class="grid grid-cols-2 gap-2">
                            <button id="btn-at-gara" onclick="selectDelivery('gara')" class="p-3 rounded-xl border-2 border-blue-600 bg-blue-50 text-blue-600 font-bold text-[10px] transition-all uppercase">Tại Gara</button>
                            <button id="btn-at-home" onclick="selectDelivery('home')" class="p-3 rounded-xl border-2 border-slate-100 text-slate-400 font-bold text-[10px] transition-all uppercase">Tại Nhà</button>
                        </div>
                        <div id="home-address-input" class="hidden">
                            <input type="text" id="cust-location" placeholder="Nhập địa chỉ giao xe tận nhà..." class="w-full bg-blue-50/50 p-4 rounded-xl border border-blue-100 font-bold text-xs outline-none focus:border-blue-600">
                        </div>
                    </div>

                    <div class="p-5 bg-slate-50 rounded-[2rem] border border-slate-100 space-y-4 shadow-inner">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center gap-2">
                                <i class="fas fa-user-tie text-blue-600 text-xs"></i>
                                <span class="font-black text-slate-900 text-[10px] uppercase italic tracking-widest">Thuê kèm tài xế</span>
                            </div>
                            <input type="checkbox" id="driver-toggle" onchange="app.handleDriverSelection()" class="w-5 h-5 rounded-lg border-blue-200 text-blue-600 focus:ring-blue-500">
                        </div>
                        <div id="driver-list-container" class="hidden space-y-2 max-h-48 overflow-y-auto pr-2 custom-scroll border-t border-slate-200 pt-3">
                            </div>
                    </div>
                </div>

                <div class="space-y-5">
                    <h4 class="text-[11px] font-black text-slate-900 uppercase border-l-4 border-blue-600 pl-3 italic">2. Thông tin khách hàng</h4>
                    <div class="space-y-3">
                        <div class="space-y-1">
                            <label class="text-[9px] font-black text-slate-400 uppercase ml-2">Họ và tên</label>
                            <input type="text" id="cust-fullname" placeholder="Nguyễn Văn A" class="w-full bg-slate-50 p-3 rounded-xl border border-slate-100 font-bold text-xs outline-none focus:ring-2 focus:ring-blue-600 transition-all uppercase">
                        </div>
                        <div class="space-y-1">
                            <label class="text-[9px] font-black text-slate-400 uppercase ml-2">Số điện thoại</label>
                            <input type="tel" id="cust-phone" placeholder="09xx xxx xxx" class="w-full bg-slate-50 p-3 rounded-xl border border-slate-100 font-bold text-xs outline-none focus:ring-2 focus:ring-blue-600 transition-all">
                        </div>
                        <div class="space-y-1">
                            <label class="text-[9px] font-black text-slate-400 uppercase ml-2">Số CCCD</label>
                            <input type="text" id="cust-cccd" placeholder="Số căn cước công dân" class="w-full bg-slate-50 p-3 rounded-xl border border-slate-100 font-bold text-xs outline-none focus:ring-2 focus:ring-blue-600 transition-all">
                        </div>
                         <div class="space-y-1">
                            <label class="text-[9px] font-black text-slate-400 uppercase ml-2 flex justify-between">
                                <span>Ảnh bằng lái xe (Mặt trước)</span>
                                <span class="text-blue-600 italic">Yêu cầu B1/B2 trở lên</span>
                            </label>
                            <div class="relative group">
                                <input type="file" id="cust-license-img" accept="image/*" class="hidden" onchange="app.handleFilePreview(this)">
                                <label for="cust-license-img" class="flex items-center justify-center gap-3 w-full bg-blue-50/50 p-3 rounded-xl border-2 border-dashed border-blue-200 cursor-pointer hover:bg-blue-100/50 hover:border-blue-400 transition-all group">
                                    <i class="fas fa-camera text-blue-500 group-hover:scale-110 transition-transform"></i>
                                    <span id="file-name-display" class="font-bold text-[10px] text-blue-600 uppercase tracking-tight">Nhấn để tải ảnh hoặc Chụp ảnh</span>
                                </label>
                            </div>
                        </div>

                        <p class="text-[8px] text-slate-400 italic mt-1 px-2 leading-tight">
                            * Lưu ý: Hợp đồng chỉ có hiệu lực khi quý khách xuất trình được bằng lái gốc chính chủ khi nhận xe.
                        </p>                   
                    <div class="p-6 bg-slate-900 rounded-[2rem] text-white shadow-xl">
                        <p class="text-[9px] font-black text-blue-400 uppercase tracking-widest mb-2">Tổng cộng dự tính </p>
                        
                    </div> <div class="flex items-baseline gap-2">
                            <span id="modal-total-price" class="text-3xl font-black text-white italic">0đ</span>
                            <span class="text-[9px] text-slate-400 uppercase italic">/ <span id="calc-days-text">1</span> ngày</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="space-y-3 mt-4">
                <label class="text-[10px] font-black text-slate-400 uppercase tracking-widest ml-2">Điều khoản hợp đồng</label>
                <div class="h-32 overflow-y-auto p-5 bg-slate-50 rounded-3xl border border-slate-100 text-[11px] text-slate-600 leading-relaxed custom-scroll text-justify">
                    <p class="font-bold text-slate-900 mb-2 text-center border-b pb-2 uppercase">Hợp đồng thuê xe TrangHy</p>
                    <p class="font-bold text-blue-600 mb-1 uppercase italic text-[10px]">1. Trách nhiệm bên thuê</p>
                    <p class="mb-3 italic opacity-80">Sử dụng xe đúng mục đích, không vi phạm pháp luật và hoàn trả xe đúng thời hạn. Mọi hư hỏng do lỗi bên thuê sẽ được bồi thường theo giá trị thực tế.</p>
                    <p class="font-bold text-blue-600 mb-1 uppercase italic text-[10px]">2. Cam kết TrangHy Autocar</p>
                    <p class="italic opacity-80">Cung cấp xe đúng chất lượng, đã được kiểm tra an toàn và hỗ trợ kỹ thuật 24/7.</p>
                </div>

                <label class="flex items-center space-x-3 cursor-pointer p-3 hover:bg-slate-50 rounded-2xl transition-all border border-transparent hover:border-slate-100">
                    <input type="checkbox" id="agree-contract" class="w-5 h-5 rounded-md border-slate-300 text-blue-600 focus:ring-blue-500">
                    <span class="text-xs font-bold text-slate-700 uppercase tracking-tighter italic">Tôi đồng ý với tất cả điều khoản hợp đồng trên</span>
                </label>
            </div>

            <div class="flex gap-4 pt-2">
                <button onclick="app.closeCar()" class="flex-1 bg-slate-100 text-slate-500 py-5 rounded-[1.5rem] font-black uppercase text-[10px] tracking-widest hover:bg-slate-200 transition-all">
                    Quay lại
                </button>
                <button onclick="app.handleBooking()" class="flex-[2] bg-blue-600 text-white py-5 rounded-[1.5rem] font-black uppercase text-[10px] tracking-widest hover:bg-blue-500 transition-all shadow-xl shadow-blue-600/20 active:scale-95">
                    Tiến hành thanh toán
                </button>
            </div>
        </div>
    </div>
</div>
<div id="payment-modal" class="hidden fixed inset-0 z-[9999] flex items-center justify-center bg-black/90 backdrop-blur-md p-4">
    <div class="bg-slate-900 border border-white/10 p-8 rounded-[3rem] max-w-md w-full shadow-2xl text-center animate-zoom-in relative">
        <h3 id="payment-title" class="text-blue-500 font-black text-xl mb-4 uppercase italic tracking-tighter">Thanh toán đặt chỗ</h3>
        
        <div class="bg-white p-4 rounded-3xl mb-6 inline-block shadow-2xl">
            <img id="qr-code" src="https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=TRANGHYAUTOCAR" class="w-48 h-48 object-contain">
        </div>
        
   <div class="max-h-[300px] overflow-y-auto pr-2 custom-scrollbar space-y-4 mb-8">
    
    <div class="text-slate-300 text-[11px] space-y-3 text-left bg-white/5 p-6 rounded-3xl border border-white/5 shadow-inner">
        <p class="flex justify-between border-b border-white/5 pb-2">
            <span>Chủ tài khoản:</span> 
            <span class="text-white font-black uppercase">Bui Van Trang</span>
        </p>
        <p class="flex justify-between border-b border-white/5 pb-2">
            <span>Số tài khoản:</span> 
            <span class="text-blue-400 font-black text-sm cursor-pointer hover:underline" onclick="copyToClipboard('0353979614')">0353979614 <i class="far fa-copy ml-1 text-[10px]"></i></span>
        </p>
        <p class="flex justify-between">
            <span>Ngân hàng:</span> 
            <span class="text-white font-bold uppercase">MB BANK</span>
        </p>
        
        <div class="pt-4 space-y-3">
            <p class="text-[9px] text-slate-500 uppercase font-black tracking-widest mb-1">Số tiền thanh toán</p>
            <p id="payment-final-amount" class="text-3xl font-black text-white italic tracking-tighter">0đ</p>
            
            <p class="text-[9px] text-slate-500 uppercase font-black mb-1 pt-4 border-t border-white/5">Nội dung chuyển khoản</p>
            <div class="flex items-center justify-between bg-blue-400/10 p-3 rounded-xl border border-blue-400/20">
                <p id="payment-description" class="text-[11px] text-blue-400 font-bold uppercase italic tracking-tight">THUE XE/TAI XE</p>
                <i class="far fa-copy text-blue-400 text-xs cursor-pointer" onclick="copyToClipboard(document.getElementById('payment-description').innerText)"></i>
            </div>
        </div>
    </div>

    <div class="p-4 bg-orange-500/10 rounded-2xl border border-orange-500/20">
        <p class="text-[10px] text-orange-400 leading-relaxed italic">
            * Lưu ý: Vui lòng nhập chính xác nội dung chuyển khoản để hệ thống tự động xác nhận đơn hàng nhanh nhất.
        </p>
    </div>
</div>

<div class="flex gap-4 sticky bottom-0 bg-slate-900 pt-2">
    <button onclick="document.getElementById('payment-modal').classList.add('hidden')" 
            class="flex-1 bg-slate-800 text-slate-500 py-4 rounded-2xl font-black uppercase text-[10px] tracking-widest hover:bg-red-500 hover:text-white transition-all">
        HỦY
    </button>
    <button id="btn-confirm-payment" onclick="showSuccessBooking('xe')"
            class="flex-1 bg-blue-600 text-white py-4 rounded-2xl font-black hover:bg-blue-500 transition-all shadow-xl shadow-blue-600/30 uppercase text-[10px] tracking-widest">
        XÁC NHẬN CHUYỂN
    </button>
</div>

<style>
    /* Làm đẹp thanh cuộn */
    .custom-scrollbar::-webkit-scrollbar { width: 4px; }
    .custom-scrollbar::-webkit-scrollbar-track { background: rgba(255,255,255,0.02); }
    .custom-scrollbar::-webkit-scrollbar-thumb { background: rgba(59, 130, 246, 0.5); border-radius: 10px; }
</style>
        </div>
    </div>
</div>
<div id="modal-driver" class="fixed inset-0 bg-slate-900/90 backdrop-blur-md z-[110] hidden flex items-center justify-center p-4">
    <div class="bg-white w-full max-w-lg rounded-[3rem] overflow-hidden shadow-2xl animate-zoom-in flex flex-col max-h-[95vh] relative">
        
        <div class="relative h-36 bg-slate-950 flex items-center justify-center shrink-0">
            <button onclick="app.closeDriver()" class="absolute top-6 right-6 w-10 h-10 bg-white/10 hover:bg-red-500 hover:rotate-90 text-white rounded-full transition-all duration-300 z-20 flex items-center justify-center">
                <i class="fas fa-times"></i>
            </button>
            <div id="dr-avatar" class="w-24 h-24 bg-gradient-to-br from-blue-600 to-blue-800 rounded-[2rem] flex items-center justify-center text-4xl font-black text-white italic shadow-2xl border-4 border-white/10 relative z-10">
                </div>
            <div class="absolute inset-0 opacity-20" style="background-image: radial-gradient(#ffffff 1px, transparent 1px); background-size: 20px 20px;"></div>
        </div>

        <div class="p-8 space-y-6 overflow-y-auto custom-scrollbar bg-white">
            
            <div class="text-center">
                <h2 id="dr-name" class="text-3xl font-black text-slate-900 italic tracking-tighter uppercase leading-none">Tên Tài Xế</h2>
                <div class="flex items-center justify-center gap-2 mt-2">
                    <span class="h-[1px] w-8 bg-blue-200"></span>
                    <p id="dr-exp" class="text-blue-600 font-black text-[10px] uppercase tracking-[0.2em]">Kinh Nghiệm</p>
                    <span class="h-[1px] w-8 bg-blue-200"></span>
                </div>
            </div>

            <div class="space-y-4 bg-slate-50 p-6 rounded-[2.5rem] border border-slate-100 shadow-inner">
                <div class="space-y-2">
                    <label class="text-[10px] font-black text-slate-400 uppercase ml-1 flex items-center gap-2">
                        <i class="fas fa-user text-[8px]"></i> Họ và Tên người thuê
                    </label>
                    <input type="text" id="dr-cust-fullname" placeholder="Nhập đầy đủ họ tên" class="w-full bg-white px-4 py-3 rounded-xl font-bold text-slate-900 outline-none text-sm border border-slate-200 focus:border-blue-500 transition-all">
                </div>
                <div class="grid grid-cols-2 gap-4">
                    <div class="space-y-2">
                        <label class="text-[10px] font-black text-slate-400 uppercase ml-1 flex items-center gap-2">
                            <i class="fas fa-phone text-[8px]"></i> Số điện thoại
                        </label>
                        <input type="tel" id="dr-cust-phone" placeholder="0353..." class="w-full bg-white px-4 py-3 rounded-xl font-bold text-slate-900 outline-none text-sm border border-slate-200 focus:border-blue-500 transition-all">
                    </div>
                    <div class="space-y-2">
                        <label class="text-[10px] font-black text-slate-400 uppercase ml-1 flex items-center gap-2">
                            <i class="fas fa-id-card text-[8px]"></i> Số CCCD
                        </label>
                        <input type="text" id="dr-cust-cccd" placeholder="033..." class="w-full bg-white px-4 py-3 rounded-xl font-bold text-slate-900 outline-none text-sm border border-slate-200 focus:border-blue-500 transition-all">
                    </div>
                </div>
            </div>

            <div class="grid grid-cols-2 gap-4">
                <div class="p-4 bg-slate-50 rounded-[1.5rem] border border-slate-100">
                    <span class="block text-[9px] font-black text-slate-400 uppercase mb-1 ml-1 tracking-widest">Ngày bắt đầu</span>
                    <div class="flex items-center gap-2">
                        <i class="far fa-calendar-alt text-blue-500 text-xs"></i>
                        <input type="date" id="dr-start-date" class="bg-transparent w-full font-black text-slate-900 outline-none text-sm">
                    </div>
                </div>
                <div class="p-4 bg-slate-50 rounded-[1.5rem] border border-slate-100">
                    <span class="block text-[9px] font-black text-slate-400 uppercase mb-1 ml-1 tracking-widest">Ngày kết thúc</span>
                    <div class="flex items-center gap-2">
                        <i class="far fa-calendar-check text-blue-500 text-xs"></i>
                        <input type="date" id="dr-end-date" class="bg-transparent w-full font-black text-slate-900 outline-none text-sm">
                    </div>
                </div>
            </div>

            <div class="bg-blue-600 p-6 rounded-[2.5rem] flex justify-between items-center shadow-xl shadow-blue-200">
                <div>
                    <span class="block text-[10px] font-black text-blue-200 uppercase tracking-widest mb-1">Tổng phí dịch vụ</span>
                    <span id="dr-total" class="text-3xl font-black text-white italic tracking-tighter">0đ</span>
                </div>
                <div class="text-right bg-white/10 px-4 py-2 rounded-2xl backdrop-blur-sm">
                    <span class="block text-[9px] font-black text-blue-100 uppercase tracking-widest">Thời gian</span>
                    <span class="text-lg font-black text-white italic"><span id="dr-days-text">1</span> Ngày</span>
                </div>
            </div>

            <div class="space-y-4">
                <label class="text-[10px] font-black text-slate-400 uppercase tracking-widest flex items-center gap-2">
                    <i class="fas fa-file-contract"></i> Điều khoản hợp đồng
                </label>
                
                <div class="h-40 overflow-y-auto p-5 bg-slate-50 rounded-3xl border border-slate-100 text-[11px] text-slate-600 custom-scrollbar text-justify shadow-inner leading-relaxed">
                    <div class="space-y-4">
                        <div class="text-center border-b border-slate-200 pb-2">
                            <p class="font-black text-slate-900 uppercase">Hợp đồng tài xế TrangHy</p>
                        </div>
                        <p class="font-black text-blue-600 uppercase text-[9px] tracking-widest">1. Trách nhiệm Bên Thuê</p>
                        <p class="italic opacity-80">Cung cấp chính xác CCCD và thông tin liên lạc. Thanh toán 100% trước khi hành trình bắt đầu.</p>
                        <p class="font-black text-blue-600 uppercase text-[9px] tracking-widest">2. Phụ phí ngoài giờ</p>
                        <p class="italic opacity-80">Phụ phí sau 10 tiếng làm việc: 100.000đ/giờ. Đảm bảo nơi nghỉ nếu đi tỉnh.</p>
                    </div>
                </div>

                <label class="flex items-center space-x-3 cursor-pointer p-4 bg-slate-50 hover:bg-blue-50 rounded-2xl transition-all group">
                    <input type="checkbox" id="agree-contract-driver" class="w-6 h-6 rounded-md border-slate-300 text-blue-600 focus:ring-blue-500">
                    <span class="text-[11px] font-black text-slate-700 uppercase tracking-tighter italic">Tôi đã đọc và đồng ý với điều khoản trên</span>
                </label>
            </div>

            <div class="flex gap-4 pt-4">
                <button onclick="app.closeDriver()" 
                    class="group flex-1 flex items-center justify-center gap-2 bg-slate-50 text-slate-400 py-5 rounded-[1.8rem] font-bold uppercase text-[10px] tracking-[0.15em] hover:bg-slate-100 hover:text-slate-600 transition-all duration-300 border border-slate-100">
                    <i class="fas fa-chevron-left text-[8px] group-hover:-translate-x-1 transition-transform"></i>
                    Quay lại
                </button>

                <button onclick="app.handleDriverBooking()" 
                    class="flex-[2.5] flex items-center justify-center gap-3 bg-gradient-to-r from-blue-600 to-blue-700 text-white py-5 rounded-[1.8rem] font-black uppercase text-[11px] tracking-[0.2em] shadow-[0_15px_30px_-5px_rgba(37,99,235,0.3)] hover:shadow-[0_20px_40px_-5px_rgba(37,99,235,0.4)] hover:-translate-y-0.5 active:scale-[0.97] transition-all duration-300">
                    <span>Xác nhận & Thanh toán ngay</span>
                    <div class="w-6 h-6 bg-white/20 rounded-full flex items-center justify-center">
                        <i class="fas fa-arrow-right text-[9px]"></i>
                    </div>
                </button>
            </div>

        </div> </div> </div> ```
<script>

function selectDelivery(type) {
    const btnGara = document.getElementById('btn-at-gara');
    const btnHome = document.getElementById('btn-at-home');
    const addressInput = document.getElementById('home-address-input');   
    if (type === 'home') {
        btnHome.classList.add('border-blue-600', 'bg-blue-50', 'text-blue-600');
        btnHome.classList.remove('border-slate-100', 'text-slate-400');
        btnGara.classList.add('border-slate-100', 'text-slate-400');
        btnGara.classList.remove('border-blue-600', 'bg-blue-50', 'text-blue-600');
        addressInput.classList.remove('hidden');
    } else {
        btnGara.classList.add('border-blue-600', 'bg-blue-50', 'text-blue-600');
        btnGara.classList.remove('border-slate-100', 'text-slate-400');
        btnHome.classList.add('border-slate-100', 'text-slate-400');
        btnHome.classList.remove('border-blue-600', 'bg-blue-50', 'text-blue-600');
        addressInput.classList.add('hidden');
        if(document.getElementById('cust-location')) document.getElementById('cust-location').value = '';
    }
}

// Quan trọng: Định nghĩa hàm này TRONG app object hoặc gọi đúng tên
// Ở đây tôi sửa lại logic onclick trong HTML để khớp với script này
app.handleDriverBooking = function() {
    const isAgreed = document.getElementById('agree-contract-driver').checked;
    if (!isAgreed) {
        alert("Vui lòng đọc và đồng ý với điều khoản hợp đồng trước khi tiếp tục!");
        return;
    }
    // Thu thập dữ liệu tài xế và mở thanh toán
    this.openDriverPayment(); 
}
</script>

    <div id="modal-pay" class="hidden fixed inset-0 z-[120] flex items-center justify-center p-4">
        <div class="absolute inset-0 bg-slate-950/80 backdrop-blur-xl" onclick="app.closePay()"></div>
        <div class="bg-white rounded-[3.5rem] w-full max-w-md relative z-10 overflow-hidden modal-anim shadow-2xl">
            <div class="bg-slate-900 p-8 text-center text-white space-y-2">
                <div class="w-16 h-16 bg-blue-600 rounded-2xl flex items-center justify-center mx-auto mb-4 rotate-12 shadow-xl">
                    <i class="fas fa-qrcode text-2xl"></i>
                </div>
                <button id="btn-confirm-payment" onclick="processContractAndZalo('xe'); showSuccessBooking('xe')"
        class="flex-1 bg-blue-600 text-white py-4 rounded-2xl font-black ...">
    XÁC NHẬN CHUYỂN
</button>
                <h3 class="text-2xl font-black uppercase tracking-tight">Thanh Toán Đặt Cọc</h3>
            </div>
            <div class="p-8 space-y-6 max-h-[70vh] overflow-y-auto custom-scroll">
                <div class="bg-white p-6 rounded-[2.5rem] border border-slate-100 shadow-inner relative">
                    <img id="qr-image" src="" alt="VietQR" class="mx-auto w-full aspect-square object-contain">
                </div>
                <div class="space-y-3">
                    <div class="flex justify-between items-center bg-slate-50 p-4 rounded-2xl">
                        <span class="text-[10px] font-black text-slate-400 uppercase">Số tiền:</span>
                        <span id="qr-amount" class="text-2xl font-black text-blue-600">0đ</span>
                    </div>
                    <div class="bg-blue-50 p-4 rounded-2xl space-y-2 border border-blue-100">
                        <span class="text-[10px] font-black text-blue-400 uppercase">Nội dung:</span>
                        <div class="flex justify-between items-center">
                            <span id="qr-memo" class="text-xs font-black text-slate-700 tracking-wider"></span>
                            <button onclick="navigator.clipboard.writeText(document.getElementById('qr-memo').innerText)" class="text-blue-600 hover:scale-110 transition-transform"><i class="far fa-copy"></i></button>
                        </div>
                    </div>
                </div>
                <button onclick="location.reload()" class="w-full py-5 bg-blue-600 text-white rounded-2xl font-black text-[11px] uppercase tracking-widest shadow-xl">Hoàn tất</button>
                <button onclick="app.closePay()" class="w-full text-slate-400 text-[10px] font-black uppercase tracking-widest hover:text-red-500">Hủy</button>
            </div>
        </div>
    </div>
    <div id="car-list" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
    </div>
    <script>
    // 3. CẬP NHẬT CON SỐ DASHBOARD
  function updateDashboard() {
    // Chỉ chạy khi app và dữ liệu đã sẵn sàng
    if (window.app && window.app.allCars) {
        const totalCars = app.allCars.length;
        document.querySelectorAll('.font-black.text-xl').forEach(el => {
            if(el.innerText.includes('XE')) el.innerText = `${totalCars} XE`;
        });
        console.log("✅ Dashboard đã đồng bộ xong.");
    }
}

    // 4. HIỂN THỊ DANH SÁCH XE
 function displayCars(data) {
    const list = document.getElementById('car-list');
    if(!list) return;

    list.innerHTML = data.map(car => {
        // Kiểm tra xem xe có đang bận (đã được thuê) không
        const isBusy = car.status === 'busy';

        return `
            <div class="car-card p-4 fade-in relative ${isBusy ? 'opacity-75' : 'cursor-pointer'}" 
                 ${isBusy ? '' : `onclick="app.openCar(${car.id})"`}>
                
                <div class="relative rounded-[1.5rem] overflow-hidden mb-6 h-48">
                    <img src="${car.image_url || car.img}" class="w-full h-full object-cover ${isBusy ? 'grayscale' : ''}">
                    
                    <span class="absolute top-4 right-4 bg-white/90 backdrop-blur px-4 py-1 rounded-full text-[10px] font-bold text-blue-600">
                        ${car.category}
                    </span>

                    ${isBusy ? `
                    <div class="absolute inset-0 bg-black/50 flex items-center justify-center">
                        <div class="bg-red-600 text-white text-[10px] font-black px-4 py-2 rounded-lg uppercase tracking-widest border border-white/20 shadow-lg">
                            Đã được thuê
                        </div>
                    </div>
                    ` : ''}
                </div>

                <div class="${isBusy ? 'pointer-events-none' : ''}">
                    <h3 class="text-xl font-bold text-slate-900 mb-2">${car.name}</h3>
                    <div class="flex justify-between items-center">
                        <p class="text-blue-600 font-black text-lg">
                            ${typeof car.price_per_day === 'number' ? car.price_per_day.toLocaleString() : car.price}
                            <span class="text-xs text-slate-400 font-medium">/ngày</span>
                        </p>
                        ${isBusy ? 
                            `<span class="text-[10px] font-bold text-slate-400 italic">Tạm hết xe</span>` : 
                            `<span class="text-[10px] font-bold text-green-600 italic">Sẵn sàng</span>`
                        }
                    </div>
                </div>
            </div>
        `;
    }).join('');
}
    // 5. LOGIC BỘ LỌC VÀ TÌM KIẾM
    function filterCars(cat, btn) {
        document.querySelectorAll('.filter-btn').forEach(b => {
            b.classList.remove('bg-white', 'shadow-lg', 'text-blue-600');
            b.classList.add('text-slate-500');
        });
        btn.classList.add('bg-white', 'shadow-lg', 'text-blue-600');
        btn.classList.remove('text-slate-500');

        const filtered = (cat === 'all') ? cars : cars.filter(c => c.category === cat);
        displayCars(filtered);
    }

    function searchCar() {
        const query = document.getElementById('carSearch').value.toLowerCase();
        const filtered = cars.filter(c => c.name.toLowerCase().includes(query));
        displayCars(filtered);
    }

    function openCar(id) {
    // 1. Tìm xe trong danh sách cars của state
    const car = this.state.cars.find(c => c.id === id);
    if (!car) return;

    // 2. LƯU XE ĐANG CHỌN VÀO STATE (Đây là bước quan trọng nhất để hết lỗi NaN)
    this.state.selectedCar = car;

    // 3. Đổ dữ liệu vào các thẻ HTML (Lưu ý: dùng đúng ID từ file HTML của bạn)
    document.getElementById('d-name').innerText = car.name;
    document.getElementById('d-img').src = car.image_url;
    document.getElementById('d-cat').innerText = car.category;
    
    // 4. Reset các ô nhập liệu và số tiền về mặc định mỗi khi mở xe mới
    document.getElementById('modal-start-date').value = "";
    document.getElementById('modal-end-date').value = "";
    document.getElementById('modal-total-price').innerText = "0đ";
    if (document.getElementById('calc-days-text')) {
        document.getElementById('calc-days-text').innerText = "0";
    }
    
    // Reset giá trị tiền trong state về 0
    this.state.totalPrice = 0;

    // 5. Hiển thị Modal
    document.getElementById('modal-car').classList.remove('hidden');
    
    // Mẹo: Đặt ngày tối thiểu là hôm nay để khách không chọn ngày trong quá khứ
    const today = new Date().toISOString().split('T')[0];
    document.getElementById('modal-start-date').setAttribute('min', today);
    document.getElementById('modal-end-date').setAttribute('min', today);
}

    function closeCar() {
        document.getElementById('modal-car').classList.add('hidden');
    }

    // CHẠY KHI TRANG SẴN SÀNG
    window.addEventListener('DOMContentLoaded', () => {
        updateDashboard();
        displayCars(cars);
    });
</script>
<div id="payment-modal" class="hidden fixed inset-0 z-[9999] flex items-center justify-center bg-black/95 backdrop-blur-md p-4">
    <div class="bg-slate-900 border border-white/10 rounded-[3rem] max-w-md w-full shadow-2xl overflow-hidden flex flex-col max-h-[90vh] animate-zoom-in relative">
        
        <div class="p-6 text-center shrink-0 border-b border-white/5">
            <h3 class="text-blue-500 font-black text-xl uppercase italic tracking-tighter">Thanh toán đặt chỗ</h3>
        </div>
        
        <div class="p-6 md:p-8 overflow-y-auto flex-1 space-y-6 custom-scroll-payment">
            
            <div class="bg-white p-3 rounded-3xl shadow-2xl w-fit mx-auto">
                <img id="qr-code" src="https://api.qrserver.com/v1/create-qr-code/?size=250x250&data=TRANGHYAUTOCAR" 
                     alt="QR Thanh toán" class="w-44 h-44 md:w-52 md:h-52 object-contain mx-auto">
            </div>
            
            <div class="text-slate-300 text-[11px] md:text-sm space-y-3 bg-white/5 p-5 rounded-3xl border border-white/5">
                <div class="flex justify-between items-center border-b border-white/5 pb-2">
                    <span class="opacity-60 uppercase font-bold text-[9px]">Chủ tài khoản</span>
                    <span class="text-white font-black uppercase tracking-tight">Bui Van Trang</span>
                </div>

                <div class="flex justify-between items-center border-b border-white/5 pb-2">
                    <span class="opacity-60 uppercase font-bold text-[9px]">Số tài khoản</span>
                    <div class="flex items-center gap-2">
                        <span class="text-blue-400 font-black tracking-widest">0353979614</span>
                        <button onclick="navigator.clipboard.writeText('0353979614'); alert('Đã sao chép số tài khoản!')" class="text-slate-500 hover:text-white transition-colors">
                            <i class="far fa-copy"></i>
                        </button>
                    </div>
                </div>

                <div class="flex justify-between items-center border-b border-white/5 pb-2">
                    <span class="opacity-60 uppercase font-bold text-[9px]">Ngân hàng</span>
                    <span class="text-white font-bold uppercase tracking-tight">MB BANK</span>
                </div>

                <div class="pt-4 text-center">
                    <p class="text-[9px] text-slate-500 uppercase font-black tracking-[0.2em] mb-1">Tổng cộng cần chuyển</p>
                    <p id="payment-final-amount" class="text-4xl font-black text-white italic tracking-tighter">0đ</p>
                </div>

                <div class="pt-3 border-t border-white/5 mt-4 text-center">
                    <p class="text-[9px] text-slate-500 uppercase font-black mb-1">Nội dung chuyển khoản</p>
                    <p id="payment-description" class="text-[12px] text-blue-400 font-bold uppercase italic break-words leading-tight">THUE XE [TEN XE] - [SDT]</p>
                </div>
            </div>

            <div class="bg-blue-600/10 p-4 rounded-2xl border border-blue-600/20">
                 <p class="text-[10px] text-blue-400 italic text-center leading-relaxed">
                    * Sau khi chuyển khoản thành công, quý khách vui lòng chụp màn hình và nhấn nút <strong>XÁC NHẬN</strong> bên dưới.
                </p>
            </div>
        </div>

        <div class="p-6 bg-slate-900 border-t border-white/5 flex gap-3 shrink-0">
            <button onclick="document.getElementById('payment-modal').classList.add('hidden')" 
                    class="flex-1 bg-slate-800 text-slate-400 py-4 rounded-2xl font-bold text-[10px] uppercase tracking-widest hover:bg-red-500/10 hover:text-red-500 transition-all">
                HỦY
            </button>
            
            <button id="btn-confirm-payment" 
                    onclick="processContractAndZalo('xe'); showSuccessBooking('xe')"
                    class="flex-[2] bg-blue-600 text-white py-4 rounded-2xl font-black text-[10px] uppercase tracking-widest shadow-xl shadow-blue-600/20 hover:bg-blue-500 active:scale-95 transition-all">
                XÁC NHẬN ĐÃ CHUYỂN
            </button>
        </div>
    </div>
</div>

<style>
/* CSS cho thanh cuộn đẹp hơn, không bị thô */
.custom-scroll-payment::-webkit-scrollbar {
    width: 4px;
}
.custom-scroll-payment::-webkit-scrollbar-track {
    background: rgba(255, 255, 255, 0.05);
}
.custom-scroll-payment::-webkit-scrollbar-thumb {
    background: #3b82f6;
    border-radius: 10px;
}
</style>

<div id="footer-placeholder"></div>
<div id="modal-car" class="hidden">...</div>
<div id="payment-modal" class="hidden">...</div>
<div id="dashboard-container" class="fixed inset-0 z-[60] bg-slate-100 hidden overflow-y-auto"></div>
  
<footer class="bg-slate-950 text-slate-400 py-16 border-t border-white/5 relative overflow-hidden">
    <div class="absolute top-0 left-1/4 w-96 h-96 bg-blue-600/10 blur-[120px] rounded-full"></div>
    
    <div class="container mx-auto px-6 relative z-10">
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-12 mb-16">
            
            <div class="space-y-6">
                <div>
                    <h2 class="text-2xl font-black text-white italic tracking-tighter">
                        TRANGHY <span class="text-blue-500">AUTOCAR</span>
                    </h2>
                    <p class="mt-4 text-sm leading-relaxed text-slate-500">
                        Thương hiệu cho thuê xe hàng đầu tại Miền Bắc. Mang đến trải nghiệm sang trọng và an toàn.
                    </p>
                </div>
                <div class="flex gap-3">
                    <a href="https://www.facebook.com/share/1EinCXhEvJ/" class="w-10 h-10 rounded-xl bg-white/5 flex items-center justify-center hover:bg-blue-600 hover:text-white transition-all">
                        <i class="fab fa-facebook-f"></i>
                    </a>
                    <a href="#" class="w-10 h-10 rounded-xl bg-white/5 flex items-center justify-center hover:bg-pink-600 hover:text-white transition-all">
                        <i class="fab fa-instagram"></i>
                    </a>
                    <a href="#" class="w-10 h-10 rounded-xl bg-white/5 flex items-center justify-center hover:bg-black hover:text-white transition-all">
                        <i class="fab fa-tiktok"></i>
                    </a>
                </div>
            </div>
           <div>
                <h3 class="text-white font-bold uppercase tracking-widest text-xs mb-6">Dịch vụ chính</h3>
                <ul class="space-y-4 text-sm">
                    <li><a href="#" class="hover:text-blue-500 transition-colors flex items-center gap-2"><span class="w-1 h-1 bg-blue-500 rounded-full"></span> Thuê xe tự lái</a></li>
                    <li><a href="#" class="hover:text-blue-500 transition-colors flex items-center gap-2"><span class="w-1 h-1 bg-blue-500 rounded-full"></span> Tài xế chuyên nghiệp</a></li>                            
                </ul>
            </div>
            <div class="space-y-6">
                <h3 class="text-white font-black uppercase tracking-[0.2em] text-sm mb-6 flex items-center gap-3">
                    <span class="w-10 h-[3px] bg-blue-600 rounded-full"></span> Liên hệ
                </h3>
                <ul class="space-y-4 text-sm">
                    <li class="flex items-center gap-4"><i class="fas fa-phone-alt text-blue-500"></i> 0353.979.614</li>
                    <li class="flex items-center gap-4"><i class="fas fa-envelope text-blue-500"></i> tranghyautocar@gmail.com</li>
                </ul>              
                <div class="relative group mt-4 overflow-hidden rounded-2xl border border-white/10 bg-slate-900 shadow-2xl">
                    <iframe 
                        src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d59654.1205634563!2d106.02482775!3d20.654035!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x3135c22ad27373a3%3A0x4d91e69a96e6914d!2zVHAuIEjGsG5nIFnDqm4sIEjGsG5nIFnDqm4!5e0!3m2!1svi!2s!4v1700000000000" 
                        width="100%" height="150" style="border:0; filter: grayscale(1) invert(0.9) contrast(1.2);" 
                        allowfullscreen="" loading="lazy">
                    </iframe>
                </div>
            </div>
            <div class="space-y-6">
              <div class="space-y-6">
    <h3 class="text-white font-black uppercase tracking-[0.2em] text-sm mb-6 flex items-center gap-3">
        <span class="w-10 h-[3px] bg-blue-600 rounded-full"></span> Bản tin
    </h3>
    <p class="text-slate-300 text-[13px] leading-relaxed">Đăng ký để nhận ưu đãi mới nhất từ TrangHy Autocar.</p>
    
    <div class="relative flex items-center bg-slate-900 rounded-xl overflow-hidden border border-white/10">
        <input type="email" id="newsletter-email" placeholder="Email..." 
               class="w-full bg-transparent py-3 px-4 text-sm outline-none text-white placeholder:text-slate-600">
        
        <button onclick="app.subscribeNewsletter()" 
                class="bg-blue-600 px-4 py-3 text-white hover:bg-blue-500 transition-all active:scale-95">
            <i class="fas fa-paper-plane"></i>
        </button>
                </div>
            </div>
        </div>
        <div class="pt-10 border-t border-white/5 flex flex-col items-center gap-6">
            <div class="flex flex-col items-center gap-2">
                <p class="text-[10px] text-slate-500 flex items-center gap-2 bg-white/5 px-4 py-2 rounded-full border border-white/5">
                    <i class="fas fa-shield-alt text-blue-500/70 animate-pulse"></i>
                    Chúng tôi cam kết bảo mật tuyệt đối thông tin của bạn.
                </p>
            </div>           
            <p class="text-slate-500 text-[10px] uppercase tracking-widest font-bold text-center">
                © 2025 <span class="text-white italic">TRANGHY AUTOCAR</span> - PRECISION ENGINEERING & EXCELLENCE
            </p>           
            <div class="flex gap-10">
                <a href="privacy.html" class="text-slate-500 hover:text-white transition-colors text-[10px] uppercase font-bold">Chính sách bảo mật</a>
                <a href="terms.html" class="text-slate-500 hover:text-white transition-colors text-[10px] uppercase font-bold">Điều khoản dịch vụ</a>
            </div>
        </div>
    </div>
</footer>
<div id="pdf-template" style="position: absolute; left: -9999px; top: -9999px;">
    </div>
 <div class="fixed-contact-buttons">
 <div class="vip-contact-container">
    <a href="https://www.facebook.com/share/1EinCXhEvJ/?mibextid=wwXIfr" target="_blank" class="vip-btn fb-vip">
        <div class="icon-box"><i class="fab fa-facebook-f"></i></div>
        <span class="btn-label">Kết nối Facebook</span>
        <span class="vip-pulse"></span>
    </a>  
    <a href="https://zalo.me/0353979614" target="_blank" class="vip-btn zalo-vip">
        <div class="icon-box">
            <i class="fas fa-comment-dots"></i> 
        </div>
        <span class="btn-label">Nhắn tin Zalo</span>
        <span class="vip-pulse"></span>
    </a>
</div>
</div>
</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="js/app.js"></script>
</body>
</html>